---
title: Hardhat, D√©ploiement et Contrat Upgradable üë∑
date: '2022-07-14'
tags: ['Web3', 'Hardhat']
draft: false
summary: D√©ployer ses Smart Contracts de mani√®re professionnelle est important pour pouvoir les maintenir correctement. Hardhat est la solution parfaite pour √ßa !
---

## Installation & configuration

Pour installer et initialiser un projet HardHat, utiliser ces commandes :
```shell
npm install hardhat
npx hardhat
```
Vous aurez un fichier "Greeter.sol" dans le dossier "contracts".
Vous pouvez compiler ce Smart Contract avec :
```shell
npx hardhat compile
```
Dans le fichier "hardhat.config.js", nous d√©finirons le chemin des artifacts (Smart Contracts compil√©s) et la Blockchain BNB Smart chain testnet pour les d√©ploiements futurs.

```js:hardhat.config.js
paths: {
 artifacts: './src/artifacts',
},
networks: {
 bsctestnet:
 {
  url: "https://speedy-nodes-nyc.moralis.io/c96c432c75339d23af5d7364/bsc/testnet",
  chainId: 97,
  accounts: [secret.key]
 }
}
```

Dans le fichier "secret.json", je mets la cl√© priv√©e de mon wallet.

```json:secret.json
{
 "key": "myPrivateKey"
}
```

## D√©ploiement d'un smart contract

Pour d√©ployer le Smart Contract, nous allons devoir cr√©er un script dans le dossier "scripts". Nous avons le "sample-script.js".

```js:sample-script.js
const hre = require("hardhat");
async function main() {
 const Greeter = await hre.ethers.getContractFactory("Greeter");
 const greeter = await Greeter.deploy("Hello, Hardhat!");
 await greeter.deployed();
 console.log("Greeter deployed to:", greeter.address);
}
```
Utilisez cette commande pour le lancer :
```shell
npx hardhat run scripts/sample-script.js --network bsctestnet
```

## Int√©raction avec le smart contract

Maintenant, nous avons d√©ploy√© le Smart Contract et nous avons l'adresse sur la Blockchain, donc nous pouvons interagir avec le Smart Contract.
Exemple de script pour d√©finir une nouvelle valeur a la variable "greet" :

```js
const hre = require("hardhat");
async function main() {
 const GreeterContract = await ethers.getContractFactory("Greeter");
 const Greeter = await GreeterContract.attach("0xC9f9f144f58d590B136D526d43E9eDE8aa24Cd91");
 const greet = await Greeter.setGreeting("Nouvelle valeur");
 const newValue = await Greeter.greet();
 console.log(newValue);
}
```
## Smart Contract Upgradable

Un Smart Contract est immuable mais nous pouvons utiliser un proxy pour r√©soudre ce probl√®me. HardHat fournit tous les outils pour le faire facilement.

### D√©ploiement avec proxy

Script pour d√©ployer un Smart Contract avec un proxy.

```js
const { ethers, upgrades } = require("hardhat");
async function main() {
 const Greeter = await ethers.getContractFactory("Greeter");
 const greeter = await upgrades.deployProxy(Greeter, ["Hello, Hardhat!"]);
 await greeter.deployed();
 console.log("Greeter deployed to:", greeter.address);
}
```

### Upgrade avec proxy

Script pour changer l'impl√©mentation du Smart Contract derri√®re le proxy. (Avoir l'adresse du proxy).

```js
const { ethers, upgrades } = require("hardhat");
async function main() {
const Greeter = await ethers.getContractFactory("Greeter");
const greeter = await upgrades.upgradeProxy("0xC9f9f144f58d590B136D526d43E9eDE8aa24Cd91", Greeter);
console.log("Greeter upgraded");
}
```

## V√©rifier Smart Contract

Pour v√©rifier un Smart Contract sur l'explorateur (bscscan.com), nous devons installer le package "@nomiclabs/hardhat-etherscan" et obtenir une cl√© API sur BscScan.

```json
etherscan: {
 apiKey: {
  bsctestnet: "yourApiKey"
 }
}
```

Et il vous suffit de lancer cette commande :
```shell
npx hardhat v
```

## Voir la vid√©o :

<YoutubeFacade
    videoId="mvf6u-EIyNw"
    title="Hardhat : Deployement et Contrat Upgradableüë∑"
/>

